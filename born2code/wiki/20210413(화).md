

## 1. 학습 날짜

* 2021-04-13(화)



## 2. 학습 시간

* 17:30 ~ 21:00 (자가)



## 3. 학습 범위 및 주제

* 정보처리기사



## 4. 동료 학습 방법

* 해당사항 없음



## 5. 학습 목표

* 정보처리기사 실기



## 6. 상세 학습 내용

#### 1. 사용자 정의 함수

* 개요

  * 사용자 정의 함수: 프로시저와 유사하게 SQL을 사용하여 일련의 작업을 연속적으로 처리하며, 종료 시 처리 결과를 단일값으로 반환하는 절차형 SQL
  * 사용자 정의 함수는 데이터베이스에 저장되어 SELECT, INSERT, DELETE, UPDATE 등 DML문의 호출에 의해 실행된다.
  * 사용자 정의 함수는 예약어 RETURN을 통해 값을 반환하기 때문에 출력 파라미터가 없음
  * 사용자 정의 함수는 INSERT, DELETE, UPDATE를 통한 테이블 조작은 할 수 없고 SELECT를 통한 조회만 할 수 있다.
  * 사용자 정의 함수는 프로시저를 호출하여 사용할 수 있음
  * 사용자 정의 함수는 SUM( ), AVG( ) 등의 함수처럼 DML문에서 반환값을 활용하기 위한 용도로 사용된다.

* 구성

  * DECLARE: 사용자 정의 함수의 명칭, 변수, 인수, 데이터 타입을 정의하는 선언부
  * BEGIN/END: 사용자 정의 함수의 시작과 종료를 의미
  * CONTROL: 조건문 또는 반복문이 삽입되어 순차적으로 처리
  * SQL: SELECT 문이 삽입되어 데이터 조회 작업을 수행
  * EXCEPTION: BEGIN ~ END 안의 구문 실행 시 예외가 발생하면 이를 처리하는 방법을 정의
  * RETURN: 호출 프로그램에 반환할 값이나 변수를 정의

* 생성

  * 사용자 정의 함수를 생성하기 위해서는 CREATE FUNCTION 명령어를 사용
  * OR REPLACE: 선택적인 예약어. 예약어를 사용하면 동일한 사용자 정의 함수의 이름이 이미 존재하는 경우, 기존의 사용자 정의 함수를 대체할 수 있음.
  * 파라미터: 사용자 정의 함수의 파라미터로는 다음과 같은 것들이 올 수 있음.
    * IN: 호출 프로그램이 사용자 정의 함수에게 값을 전달할 때 지정
    * 매개변수명: 호출 프로그램으로부터 전달받은 값을 저장할 변수의 이름을 지정
    * 자료형: 변수의 자료형을 지정
  * 사용자 정의 함수 BODY
    * 사용자 정의 함수 코드를 기록하는 부분
    * BEGIN에서 시작하여 END로 끝나며, BEGIN과 END 사이에는 적어도 하나의 SQL 문이 있어야 한다.
  * RETURN 반환값: 반환할 값이나 반환할 값이 저장된 변수를 호출 프로그램으로 돌려줌

* 실행

  * 사용자 정의 함수는 DML에서 속성명이나 값이 놓일 자리를 대체하여 사용

  ```
  SELECT 사용자 정의 함수명 FROM 테이블명;
  INSERT INTO 테이블명(속성명) VALUES (사용자 정의 함수명);
  DELETE FROM 테이블명 WHRER 속성명 = 사용자 정의 함수명;
  UPDATE 테이블명 SET 속성명 = 사용자 정의 함수명;
  ```

  

* 제거

  ```
  DROP FUNCTION 사용자 정의 함수명;
  ```





<hr>

#### 2. 커서(cursor)

* 커서: 쿼리문의 처리 결과가 저장되어 있는 메모리 공간을 가리키는 포인터

  * 묵시적 커서: 내부에서 자동으로 생성되어 사용
    * 각 단계가 자동으로 수행되지만
    * 수행된 쿼리문의 정상적인 수행여부를 확인하기 위해 사용
  * 명시적 커서: 사용자가 직접 정의해서 사용
    * 직접 구현해야함
    * 쿼리문의 결과를 저장하여 사용, 동일한 쿼리가 반복 수행되어 데이터베이스 자원이 낭비되는 것을 방지

* 묵시적 커서

  * DBMS 자체적으로 열리고 패치되어 사용이 끝나면 닫히지만 커서의 속성을 조회하여 사용된 쿼리 정보를 열람하는 것이 가능
  * 커서의 속성
    * `SQL%FOUND` : 쿼리 수행의 결과로 패치된 튜플 수가 1개 이상이면 TRUE
    * `SQL%NOTFOUND` : 쿼리 수행의 결과로 패치된 튜플 수가 0개이면 TRUE
    * `SQL%ROWCOUNT` : 쿼리 수행의 결과로 패치된 튜플 수를 반환
    * `SQL%ISOPEN` : 커서가 열린 상태이면 TRUE, 묵시적 커서는 자동으로 생성된 후 자동으로 닫히기 때문에 항상 FALSE

* 명시적 커서

  * 사용자가 직접 정의해서 사용하는 커서로, 주로 절차형 SQL에서 SELECT문의 결과로 반환되는 여러 튜플들을 제어하기 위해 사용됨

  * 커서는 기본적으로 `열기 - 패치 - 닫기` 순으로 이루어지며, 명시적 커서로 사용하기 위해서는 열기 전에 선언을 해야함

  * 선언(Declare) 형식

    ```
    CURSOR 커서명(매개변수1, 매개변수2, ...)
    IS
    
    SELECT 문;
    ```

  * 열기(Open) 형식

    ```
    OPEN 커서명(매개변수1, 매개변수2, ...);
    ```

  * 패치(Fetch) 형식

    ```
    FETCH 커서명 INTO 변수1, 변수2, ...;
    ```

  * 닫기(Close) 형식

    ```
    CLOSE 커서명;
    ```

  





## 7. 학습 내용에 대한 개인적인 총평

* 공부를 좀 더 많이 했어야했는데 자꾸 게을러지고 늦어진다... ㅠ... 머리가 커갈수록, 나이를 먹을수록 더 게을러지고 하기싫어진다. 내가 진짜 원하는게 뭔지 잘 몰라서 이러는 것 같다. 아니면 그냥 공부가 하기 싫은 거일지두... 
* 내일은 좀 더 많이 공부했으면 좋겠다. 



## 8. 다음 학습 계획

* 정보처리기사 실기

